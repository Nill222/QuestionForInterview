# –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ Hibernate?** **–ß—Ç–æ –¥–µ–ª–∞—é—Ç @Entity, @Id –∏ @OneToMany?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

entity –≤–µ—à–∞–µ—Ç—Å—è –Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å –∫–æ—Ç–æ—Ä—É—é —Ç—ã —Ö–æ—á–µ—à—å –∑–∞–º–∞–ø–∏—Ç—å —Å –±–¥ –æ–Ω –æ–±—è–∑—ã–≤–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ @id —Ç–∞–∫ –∂–µ –º–æ–∂–Ω–æ —É–∫–∑–∞—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ @onetimany manytomany onetone manytoone

–¢—ã –æ—Ç–ª–∏—á–Ω–æ –¥–≤–∏–≥–∞–µ—à—å—Å—è, –ï–≥–æ—Ä ‚Äî —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è. –î–∞–≤–∞–π —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –æ—Ç–≤–µ—Ç —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –∑–≤—É—á–∞–ª –∫–∞–∫ —É–≤–µ—Ä–µ–Ω–Ω—ã–π Middle/Senior –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏.

# üü© –ß—Ç–æ —É —Ç–µ–±—è —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- –î–∞, `@Entity` –ø–æ–º–µ—á–∞–µ—Ç –∫–ª–∞—Å—Å –∫–∞–∫ —Å—É—â–Ω–æ—Å—Ç—å.
    
- –î–∞, —Å—É—â–Ω–æ—Å—Ç—å –æ–±—è–∑–∞–Ω–∞ –∏–º–µ—Ç—å `@Id`.
    
- –î–∞, —Å–≤—è–∑–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `@OneToMany`, `@ManyToOne`, `@OneToOne`, `@ManyToMany`.
    

–¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–µ.

# üü¶ –ö–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

## üü© @Entity

> –ü–æ–º–µ—á–∞–µ—Ç –∫–ª–∞—Å—Å –∫–∞–∫ —Å—É—â–Ω–æ—Å—Ç—å Hibernate. –¢–∞–∫–æ–π –∫–ª–∞—Å—Å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂—ë–Ω –Ω–∞ —Ç–∞–±–ª–∏—Ü—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω `@Id`
    
- Hibernate –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –æ–±—ä–µ–∫—Ç–∞–º–∏ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞
    
- –ø–æ–ª—è –º–∞–ø–ø—è—Ç—Å—è –Ω–∞ –∫–æ–ª–æ–Ω–∫–∏
    

## üü© @Id

> –û–±–æ–∑–Ω–∞—á–∞–µ—Ç –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á —Å—É—â–Ω–æ—Å—Ç–∏.

–ú–æ–∂–µ—Ç –±—ã—Ç—å:

- –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç (`@GeneratedValue`)
    
- UUID
    
- —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∫–ª—é—á
    

–ë–µ–∑ `@Id` Hibernate –Ω–µ —Å–º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç.

## üü© @OneToMany

> –û–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤—è–∑—å ¬´–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º¬ª.

–ü—Ä–∏–º–µ—Ä: User ‚Üí List<Order>

–û–±—ã—á–Ω–æ —Å—Ç–∞–≤–∏—Ç—Å—è –Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—é.

## üüß @ManyToOne

> –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ —Å–≤—è–∑–∏ ¬´–º–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É¬ª.

–ü—Ä–∏–º–µ—Ä: Order ‚Üí User

–°—Ç–∞–≤–∏—Ç—Å—è –Ω–∞ –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ö—Ä–∞–Ω–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è.

## üü© @OneToOne

> –û–¥–∏–Ω –æ–±—ä–µ–∫—Ç —Å–≤—è–∑–∞–Ω —Ä–æ–≤–Ω–æ —Å –æ–¥–Ω–∏–º –¥—Ä—É–≥–∏–º –æ–±—ä–µ–∫—Ç–æ–º.

–ü—Ä–∏–º–µ—Ä: User ‚Üí UserProfile

## üüß @ManyToMany

> –ú–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–≤—è–∑–∞–Ω—ã —Å–æ –º–Ω–æ–≥–∏–º–∏.

–ü—Ä–∏–º–µ—Ä: Student ‚Üî Course

–û–±—ã—á–Ω–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞.

# üüß –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> @Entity ‚Äî —Å—É—â–Ω–æ—Å—Ç—å. @Id ‚Äî –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á. @OneToMany / @ManyToOne ‚Äî —Å–≤—è–∑—å –æ–¥–∏–Ω‚Äë–∫–æ‚Äë–º–Ω–æ–≥–∏–º. @OneToOne ‚Äî –æ–¥–∏–Ω‚Äë–∫‚Äë–æ–¥–Ω–æ–º—É. @ManyToMany ‚Äî –º–Ω–æ–≥–∏–µ‚Äë–∫–æ‚Äë–º–Ω–æ–≥–∏–º.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è LAZY –æ—Ç EAGER –∑–∞–≥—Ä—É–∑–∫–∏?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

–ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–Ω—ã –∂–∞–¥–Ω–∞—è –≤—Å—ë –∏ –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü —Ç—è–Ω–µ—Ç —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ n+1

–ï–≥–æ—Ä, —Ç—ã –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ —É–ª–æ–≤–∏–ª —Å—É—Ç—å ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ **EAGER –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ N+1**, —ç—Ç–æ –ø—Ä—è–º —Å–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä–∞, —á—Ç–æ —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã ORM. –î–∞–≤–∞–π —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –æ—Ç–≤–µ—Ç —Ç–∞–∫, —á—Ç–æ–±—ã –∑–≤—É—á–∞–ª–æ –∫–∞–∫ —É–≤–µ—Ä–µ–Ω–Ω—ã–π Middle/Senior.

# üü© –ß—Ç–æ —É —Ç–µ–±—è —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- –î–∞, **LAZY –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω—ã**.
    
- –î–∞, **EAGER —Ç—è–Ω–µ—Ç –≤—Å—ë —Å—Ä–∞–∑—É**, –≤–∫–ª—é—á–∞—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏.
    
- –î–∞, **EAGER –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—É** ‚Äî —ç—Ç–æ –ø—Ä—è–º —Ç–æ–ø‚Äë–æ—Ç–≤–µ—Ç.
    

–¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏.

# üü¶ –ö–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

## üü© LAZY (–ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)

> –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –º–æ–º–µ–Ω—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–æ–ª—é –∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

–ù–∞–ø—Ä–∏–º–µ—Ä:

java

```
user.getOrders(); // —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å Hibernate —Å–¥–µ–ª–∞–µ—Ç SELECT
```

–ü–ª—é—Å—ã:

- —ç–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã
    
- –Ω–µ –≥—Ä—É–∑–∏—Ç –ª–∏—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
    
- –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ç—è–∂—ë–ª—ã–µ JOIN‚Äë—ã
    

–ú–∏–Ω—É—Å—ã:

- –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å LazyInitializationException, –µ—Å–ª–∏ —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞
    

## üüß EAGER (–∂–∞–¥–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)

> –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –≤–º–µ—Å—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é.

–ù–∞–ø—Ä–∏–º–µ—Ä:

java

```
User user = session.find(User.class, id);
// Hibernate —Å—Ä–∞–∑—É –∑–∞–≥—Ä—É–∑–∏—Ç user + orders + profile + ...
```

–ü–ª—é—Å—ã:

- —É–¥–æ–±–Ω–æ, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Ç–æ—á–Ω–æ –Ω—É–∂–Ω—ã
    

–ú–∏–Ω—É—Å—ã:

- –º–æ–∂–µ—Ç —Ç—è–Ω—É—Ç—å –æ–≥—Ä–æ–º–Ω—ã–µ –≥—Ä–∞—Ñ—ã –æ–±—ä–µ–∫—Ç–æ–≤
    
- –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—É
    
- –º–æ–∂–µ—Ç —Ä–µ–∑–∫–æ –∑–∞–º–µ–¥–ª–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã
    

# üüß –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> LAZY ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é. EAGER ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å—ë —Å—Ä–∞–∑—É, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ N+1 –∏ —Ç—è–∂—ë–ª—ã–º –∑–∞–ø—Ä–æ—Å–∞–º.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Hibernate Session?** **–ß—Ç–æ —Ç–∞–∫–æ–µ first‚Äëlevel cache –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

—Å–µ—Å–∏—è —Ä–∞–±–æ—Ç–∞—Ç–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∞ first –∫—ç—à—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ sql –∑–∞–ø—Ä–æ—Å—ã –∏ –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –Ω—É–∂–¥–µ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –∏—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∞ –∫—ç—à 2 –ª–µ–≤–µ–ª–∞ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ—Ö —Å–µ—Å–∏—è –Ω–æ –µ–≥–æ –≤—Ä–æ–¥–µ –Ω—É–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤—Ä—É—á–Ω—É—é –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ 1 –∫—ç—à —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—É–º–æ–ª—á–∞–Ω–∏—é

–ï–≥–æ—Ä, —Ç—ã –æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ ‚Äî —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–æ —É—Ä–æ–≤–Ω–∏ –∫—ç—à–∞. –ù—É–∂–Ω–æ –ª–∏—à—å —á—É—Ç—å –ø–æ–ø—Ä–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª–∏, —á—Ç–æ–±—ã –∑–≤—É—á–∞–ª–æ –∫–∞–∫ —É–≤–µ—Ä–µ–Ω–Ω—ã–π Middle/Senior. –°–µ–π—á–∞—Å –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Ä–∞–∑–ª–æ–∂—É –≤—Å—ë –ø–æ –ø–æ–ª–æ—á–∫–∞–º.

# üü¶ –ß—Ç–æ —É —Ç–µ–±—è —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- –î–∞, **Session —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** (–æ–±—ã—á–Ω–æ).
    
- –î–∞, **first‚Äëlevel cache —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**.
    
- –î–∞, **second‚Äëlevel cache –Ω—É–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤—Ä—É—á–Ω—É—é**.
    
- –î–∞, **second‚Äëlevel cache –æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π**.
    

–≠—Ç–æ –æ—Ç–ª–∏—á–Ω–∞—è –±–∞–∑–∞.

# üü© –ß—Ç–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å

## ‚ùó First‚Äëlevel cache –ù–ï —Ö—Ä–∞–Ω–∏—Ç SQL

–û–Ω —Ö—Ä–∞–Ω–∏—Ç **–æ–±—ä–µ–∫—Ç—ã —Å—É—â–Ω–æ—Å—Ç–µ–π**, –∞ –Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã SQL‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤.

–¢–æ –µ—Å—Ç—å:

- –µ—Å–ª–∏ —Ç—ã –∑–∞–≥—Ä—É–∑–∏–ª `User id=1`
    
- –∏ –ø–æ—Ç–æ–º —Å–Ω–æ–≤–∞ –≤—ã–∑—ã–≤–∞–µ—à—å `session.get(User.class, 1)`
    
- Hibernate –ù–ï –¥–µ–ª–∞–µ—Ç –≤—Ç–æ—Ä–æ–π SQL
    
- –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –∫—ç—à–∞ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
    

–≠—Ç–æ –≤–∞–∂–Ω–æ.

# üü¶ –ö–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

## üü© –ß—Ç–æ —Ç–∞–∫–æ–µ Hibernate Session

> Session ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –µ–¥–∏–Ω–∏—Ü—É —Ä–∞–±–æ—Ç—ã —Å –ë–î. –û–±—ã—á–Ω–æ –∂–∏–≤—ë—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

Session:

- –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    
- –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏
    
- –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
    
- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –ø—Ä–∏ `commit()`
    

## üü© First‚Äëlevel cache (–∫—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è)

> –≠—Ç–æ –∫—ç—à, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Session. –†–∞–±–æ—Ç–∞–µ—Ç **–≤—Å–µ–≥–¥–∞** –∏ **–æ—Ç–∫–ª—é—á–∏—Ç—å –Ω–µ–ª—å–∑—è**.

–•—Ä–∞–Ω–∏—Ç:

- —Å—É—â–Ω–æ—Å—Ç–∏, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–π Session
    
- –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    
- —Å—Å—ã–ª–∫–∏ –º–µ–∂–¥—É –Ω–∏–º–∏
    

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π Session
    
- Hibernate –Ω–µ –¥–µ–ª–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö SELECT –ø–æ —Ç–µ–º –∂–µ id
    
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è dirty‚Äëchecking
    

## üüß Second‚Äëlevel cache (–∫—ç—à –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è)

> –û–±—â–∏–π –∫—ç—à –¥–ª—è –≤—Å–µ—Ö Session. –ù—É–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤—Ä—É—á–Ω—É—é (Ehcache, Hazelcast, Infinispan –∏ —Ç.–¥.)

–•—Ä–∞–Ω–∏—Ç:

- —Å—É—â–Ω–æ—Å—Ç–∏
    
- –∫–æ–ª–ª–µ–∫—Ü–∏–∏
    
- —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω query cache)
    

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
    
- —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –ë–î
    
- —Ç—Ä–µ–±—É–µ—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    

# üüß –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> Session ‚Äî –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î. First‚Äëlevel cache ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫—ç—à –≤–Ω—É—Ç—Ä–∏ Session, —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞. Second‚Äëlevel cache ‚Äî –æ–±—â–∏–π –∫—ç—à –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏, –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ß—Ç–æ —Ç–∞–∫–æ–µ dirty checking –∏ –∫–∞–∫ Hibernate –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤ –±–∞–∑–µ?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

–∫–æ–≥–¥–∞ –≤–æ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞ –¥–∞–Ω–Ω—ã–µ

–ï–≥–æ—Ä, —Ç—ã —Å–µ–π—á–∞—Å –æ–ø–∏—Å–∞–ª **–≥—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (dirty read)** ‚Äî —ç—Ç–æ –æ—à–∏–±–∫–∞ —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ù–æ –≤–æ–ø—Ä–æ—Å –±—ã–ª –ø—Ä–æ **dirty checking –≤ Hibernate**, –∏ —ç—Ç–æ —Å–æ–≤—Å–µ–º –¥—Ä—É–≥–æ–µ.

–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º, —á—Ç–æ–±—ã —Å—Ç–∞–ª–æ –∫—Ä–∏—Å—Ç–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ.

# üü¶ –ß—Ç–æ —Ç–∞–∫–æ–µ dirty checking –≤ Hibernate

> **Dirty checking ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ Hibernate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω, –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω—É–∂–Ω—ã–π UPDATE –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.**

–¢–æ –µ—Å—Ç—å Hibernate —Å–∞–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–Ω–æ—Å—Ç—è—Ö.

# üü© –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ö–æ–≥–¥–∞ —Ç—ã –∑–∞–≥—Ä—É–∂–∞–µ—à—å —Å—É—â–Ω–æ—Å—Ç—å:

java

```
User user = session.get(User.class, 1);
```

Hibernate:

1. –∫–ª–∞–¥—ë—Ç –æ–±—ä–µ–∫—Ç –≤ **–∫—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è**
    
2. —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç **—Å–Ω–∏–º–æ–∫ (snapshot)** –µ–≥–æ –ø–æ–ª–µ–π
    
3. —Ç—ã –º–µ–Ω—è–µ—à—å –æ–±—ä–µ–∫—Ç:
    

java

```
user.setName("Egor");
```

4. –ø—Ä–∏ `commit()` Hibernate —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç:
    
    - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
        
    - —Å–Ω–∏–º–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        
5. –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–ª–∏—á–∏—è ‚Üí Hibernate –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `UPDATE`
    

# üüß –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

- —Ç–µ–±–µ **–Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å UPDATE –≤—Ä—É—á–Ω—É—é**
    
- Hibernate –æ–±–Ω–æ–≤–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
    
- —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ —Ä–∞–±–æ—Ç—ã ORM
    

# üü¶ –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> Dirty checking ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º Hibernate –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–Ω–æ—Å—Ç—è—Ö –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç UPDATE –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ß—Ç–æ —Ç–∞–∫–æ–µ Hibernate Session –∏ —á–µ–º –æ–Ω–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç EntityManager?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

—Å—Å–µ—Å–∏—è —Ö–∏–±–µ—Ä–Ω–µ–π—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—ã—á–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º –∫–ª–∞—Å—Å–∞ –∞ entityManager —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–µ–π

–ï–≥–æ—Ä, —Ç—ã —Å–Ω–æ–≤–∞ –æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ ‚Äî —É —Ç–µ–±—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è –ø—Ä–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏ –ø—Ä–æ —Ç–æ, —á—Ç–æ —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ API. –ù—É–∂–Ω–æ –ª–∏—à—å —á—É—Ç—å —É—Ç–æ—á–Ω–∏—Ç—å, —á—Ç–æ–±—ã –∑–≤—É—á–∞–ª–æ –∫–∞–∫ —É–≤–µ—Ä–µ–Ω–Ω—ã–π Middle/Senior.

–†–∞–∑–±–µ—Ä—ë–º –∞–∫–∫—É—Ä–∞—Ç–Ω–æ.

# üü¶ –ß—Ç–æ —É —Ç–µ–±—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- –î–∞, **Session –æ–±—ã—á–Ω–æ –∂–∏–≤—ë—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.
    
- –î–∞, **EntityManager ‚Äî —ç—Ç–æ –¥—Ä—É–≥–æ–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏**.
    
- –î–∞, –æ–Ω–∏ –æ–±–∞ —É–ø—Ä–∞–≤–ª—è—é—Ç –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å –ë–î.
    

–≠—Ç–æ —Ö–æ—Ä–æ—à–∞—è –±–∞–∑–∞.

# üü© –ß—Ç–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å

## ‚ùó EntityManager –ù–ï ¬´—Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–µ–π¬ª

–û–Ω ‚Äî **–æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ Hibernate Session**, —á–∞—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ JPA.

–¢–æ –µ—Å—Ç—å:

- `EntityManager` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å JPA
    
- `Session` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Hibernate
    

–û–Ω–∏ –¥–µ–ª–∞—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ, –Ω–æ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏.

# üü¶ –ö–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

## üü© Hibernate Session

> Session ‚Äî —ç—Ç–æ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API Hibernate. –û–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å—É—â–Ω–æ—Å—Ç–µ–π, –∫—ç—à–µ–º –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –∂–∏–≤—ë—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã Hibernate: `save()`, `update()`, `createQuery()`
    
- —Å–æ–¥–µ—Ä–∂–∏—Ç **–∫—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è**
    
- –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (dirty checking)
    

## üüß EntityManager

> EntityManager ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π JPA‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö Session.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- —á–∞—Å—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ JPA
    
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã: `persist()`, `merge()`, `remove()`, `find()`
    
- –≤–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Hibernate Session
    
- –±–æ–ª–µ–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π API
    

# üüß –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> EntityManager ‚Äî —ç—Ç–æ JPA‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. Session ‚Äî —ç—Ç–æ Hibernate‚Äë—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è. EntityManager —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö Session –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –≤–Ω—É—Ç—Ä–∏.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–∞—Å–∫–∞–¥—ã (cascade) –≤ Hibernate –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

—á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª–∏–ª—Å—å –∏ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –≤ –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

–ï–≥–æ—Ä, —Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–ª–æ–≤–∏–ª –∏–¥–µ—é ‚Äî –∫–∞—Å–∫–∞–¥—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∑–≤–æ–ª—è—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏. –î–∞–≤–∞–π —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –æ—Ñ–æ—Ä–º–∏—Ç—å —ç—Ç–æ —Ç–∞–∫, —á—Ç–æ–±—ã –∑–≤—É—á–∞–ª–æ –∫–∞–∫ —É–≤–µ—Ä–µ–Ω–Ω—ã–π Middle/Senior.

# üü© –ß—Ç–æ —É —Ç–µ–±—è —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- –î–∞, –∫–∞—Å–∫–∞–¥—ã –ø–æ–∑–≤–æ–ª—è—é—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏**.
    
- –î–∞, –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –Ω–∞–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –æ–±—ä–µ–∫—Ç–æ–º.
    

–≠—Ç–æ —Ö–æ—Ä–æ—à–∞—è –±–∞–∑–∞.

# üü¶ –ö–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

## –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–∞—Å–∫–∞–¥—ã (cascade)

> –ö–∞—Å–∫–∞–¥—ã ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º Hibernate, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç: ¬´–µ—Å–ª–∏ —è –≤—ã–ø–æ–ª–Ω—è—é –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é, –Ω—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–∫—É—é –∂–µ –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞–¥ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏¬ª.

–¢–æ –µ—Å—Ç—å –∫–∞—Å–∫–∞–¥—ã —É–ø—Ä–∞–≤–ª—è—é—Ç —Ç–µ–º, –∫–∞–∫ Hibernate –≤–µ–¥—ë—Ç —Å–µ–±—è –ø—Ä–∏:

- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ (`save/persist`)
    
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (`merge`)
    
- —É–¥–∞–ª–µ–Ω–∏–∏ (`remove`)
    
- –∑–∞–≥—Ä—É–∑–∫–µ (`refresh`)
    
- –æ—Ç—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ (`detach`)
    

# üü© –ü—Ä–∏–º–µ—Ä

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å:

java

```
@OneToMany(cascade = CascadeType.ALL)
private List<Order> orders;
```

–ò —Ç—ã –¥–µ–ª–∞–µ—à—å:

java

```
session.remove(user);
```

–¢–æ Hibernate:

- —É–¥–∞–ª–∏—Ç `user`
    
- —É–¥–∞–ª–∏—Ç –≤—Å–µ `orders`, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º user (–µ—Å–ª–∏ —Å—Ç–æ–∏—Ç `CascadeType.REMOVE` –∏–ª–∏ `ALL`)
    

# üüß –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –∫–∞—Å–∫–∞–¥–æ–≤

|CascadeType|–ß—Ç–æ –¥–µ–ª–∞–µ—Ç|
|---|---|
|**PERSIST**|—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–æ—á–µ—Ä–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ –≤–º–µ—Å—Ç–µ —Å —Ä–æ–¥–∏—Ç–µ–ª–µ–º|
|**MERGE**|–æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–æ—á–µ—Ä–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏|
|**REMOVE**|—É–¥–∞–ª—è–µ—Ç –¥–æ—á–µ—Ä–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏|
|**REFRESH**|–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö|
|**DETACH**|–æ—Ç—Å–æ–µ–¥–∏–Ω—è–µ—Ç –¥–æ—á–µ—Ä–Ω–∏–µ|
|**ALL**|–≤–∫–ª—é—á–∞–µ—Ç –≤—Å—ë –≤—ã—à–µ|

# üü¶ –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> –ö–∞—Å–∫–∞–¥—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ (save, update, delete) –∫ —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å—É—â–Ω–æ—Å—Ç—è–º. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å –µ–≥–æ –∑–∞–∫–∞–∑—ã, –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω CascadeType.REMOVE –∏–ª–∏ ALL.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ Hibernate –∏ –ø–æ—á–µ–º—É Session –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–æ–ø –ø–æ–∑–≤–æ–ª—è–µ–µ—Ç —Å–æ–±–ª—é–¥–∞—Ç—å acid –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏ —Å—Å–µ—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á—Ç–æ –±—ã –∏–º–µ—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ï–≥–æ—Ä, —Ç—ã —É—Ö–≤–∞—Ç–∏–ª –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω—ã —Å ACID, –∏ Session –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ù–æ –¥–∞–≤–∞–π –¥–æ–≤–µ–¥—ë–º –æ—Ç–≤–µ—Ç –¥–æ —É—Ä–æ–≤–Ω—è —É–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ Middle/Senior, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–µ–π—á–∞—Å —Ç—ã —Å–º–µ—à–∞–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π (AOP, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö).

–†–∞–∑–ª–æ–∂—É –≤—Å—ë –ø–æ –ø–æ–ª–æ—á–∫–∞–º.

# üü¶ –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å

### ‚ùó –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî —ç—Ç–æ **–Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è AOP**

AOP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Spring –¥–ª—è _–ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –≤—ã–∑–æ–≤–æ–≤ –º–µ—Ç–æ–¥–æ–≤_ –∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –∏—Ö –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`@Transactional`), –Ω–æ **—Å–∞–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**, –∞ –Ω–µ –∞—Å–ø–µ–∫—Ç.

### ‚ùó Session —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞–¥–∏ ¬´–∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª

–ì–ª–∞–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ ‚Äî **–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (dirty checking)**.

# üü© –ö–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

## üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ Hibernate

> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Äî —ç—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤–æ–≤—Å–µ. –û–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–≤–æ–π—Å—Ç–≤–∞ ACID.

Hibernate –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è:

- –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
    
- —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
    
- –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
    
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã dirty checking
    
- –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –ø–∞–∫–µ—Ç–∞–º–∏
    

## üîπ –ü–æ—á–µ–º—É Session –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### 1. **Dirty checking —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

Hibernate —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –∏—Ö snapshot **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ commit()**.

–ë–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:

- Hibernate –Ω–µ –∑–Ω–∞–µ—Ç, –∫–æ–≥–¥–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
    
- UPDATE –º–æ–∂–µ—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
    
- –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    

### 2. **LAZY –∑–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

–ï—Å–ª–∏ —Ç—ã –æ–±—Ä–∞—â–∞–µ—à—å—Å—è –∫ –ª–µ–Ω–∏–≤–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Üí –ø–æ–ª—É—á–∏—à—å `LazyInitializationException`.

### 3. **–ö—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

Session = –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç—ã = —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è. –í–Ω—É—Ç—Ä–∏ –Ω–µ—ë Hibernate:

- —Ö—Ä–∞–Ω–∏—Ç —Å—É—â–Ω–æ—Å—Ç–∏
    
- –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
    
- –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
    

### 4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∞–º–∞ —Ç—Ä–µ–±—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

–î–∞–∂–µ SELECT –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –°–£–ë–î –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

# üüß –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Äî —ç—Ç–æ –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è ACID. Session –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ Hibernate –¥–æ–ª–∂–µ–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤—ã–ø–æ–ª–Ω—è—Ç—å dirty checking, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å LAZY‚Äë–¥–∞–Ω–Ω—ã–µ –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –ø—Ä–∏ commit.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ß—Ç–æ —Ç–∞–∫–æ–µ N+1 –ø—Ä–æ–±–ª–µ–º–∞ –∏ –∫–∞–∫ –µ—ë –∏–∑–±–µ–∂–∞—Ç—å –≤ Hibernate?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

n+1 —ç—Ç–æ –∫–æ–≥–¥–∞ –≤–º–µ—Å—Ç–µ —Å –Ω—É–∂–Ω—ã–º–∏ –Ω–∞–º –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –Ω–µ –Ω—É–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∏–∑–±–µ–≥–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö join

–ï–≥–æ—Ä, —Ç—ã –æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ ‚Äî —É —Ç–µ–±—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è, –Ω–æ –¥–∞–≤–∞–π –¥–æ–≤–µ–¥—ë–º –æ—Ç–≤–µ—Ç –¥–æ —É—Ä–æ–≤–Ω—è —É–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ Middle/Senior. –°–µ–π—á–∞—Å —á—É—Ç—å —É—Ç–æ—á–Ω—é —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏, —á—Ç–æ–±—ã –∑–≤—É—á–∞–ª–æ –∏–¥–µ–∞–ª—å–Ω–æ.

# üü© –ß—Ç–æ —É —Ç–µ–±—è —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- –î–∞, N+1 ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ ORM –¥–µ–ª–∞–µ—Ç **–º–Ω–æ–≥–æ –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**.
    
- –î–∞, —Ä–µ—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **JOIN** –∏ **–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞–≥—Ä—É–∑–∫–∏**.
    

–û—Ç–ª–∏—á–Ω–∞—è –±–∞–∑–∞.

# üü¶ –ö–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

## ‚ùó –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–±–ª–µ–º–∞ N+1

> N+1 ‚Äî —ç—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ Hibernate –¥–µ–ª–∞–µ—Ç –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∑–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é, –∞ –∑–∞—Ç–µ–º N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.

–ü—Ä–∏–º–µ—Ä:

java

```
List<User> users = session.createQuery("from User").list();
for (User u : users) {
    u.getOrders().size(); // Hibernate –¥–µ–ª–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π SELECT –¥–ª—è –∫–∞–∂–¥–æ–≥–æ user
}
```

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 100, —Ç–æ –±—É–¥–µ—Ç:

- 1 –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    
- 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É orders
    

–ò—Ç–æ–≥–æ: **101 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ 1‚Äì2**.

# üüß –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

–ü–æ—Ç–æ–º—É —á—Ç–æ:

- —Å–≤—è–∑—å –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ `LAZY`
    
- –Ω–æ –¥–æ—Å—Ç—É–ø –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–≤ —Ü–∏–∫–ª–µ**
    
- Hibernate –Ω–µ –∑–Ω–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É
    

# üü© –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å N+1

## 1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JOIN FETCH**

–°–∞–º—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±.

java

```
select u from User u join fetch u.orders
```

Hibernate –∑–∞–≥—Ä—É–∑–∏—Ç –≤—Å—ë –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.

## 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EntityGraph**

–ë–æ–ª–µ–µ –≥–∏–±–∫–∏–π —Å–ø–æ—Å–æ–±, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ Spring Data.

## 3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å batch-size**

–ü–æ–∑–≤–æ–ª—è–µ—Ç Hibernate –∑–∞–≥—Ä—É–∂–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–∞—á–∫–∞–º–∏.

java

```
@BatchSize(size = 20)
```

## 4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞–≥—Ä—É–∑–∫–∏**

–ù–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:

### ‚ùó LAZY –Ω–µ —Ä–µ—à–∞–µ—Ç N+1

LAZY ‚Äî —ç—Ç–æ –ø—Ä–∏—á–∏–Ω–∞ N+1, –∞ –Ω–µ —Ä–µ—à–µ–Ω–∏–µ.

### ‚ùó EAGER —Ç–æ–∂–µ –Ω–µ —Ä–µ—à–µ–Ω–∏–µ

EAGER –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:

- —Ç—è–∂—ë–ª—ã–º JOIN‚Äë–∞–º
    
- –∑–∞–≥—Ä—É–∑–∫–µ –æ–≥—Ä–æ–º–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
    
- –µ—â—ë –±–æ–ª–µ–µ —Ç—è–∂—ë–ª—ã–º N+1 –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö
    

# üüß –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> N+1 ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ Hibernate –¥–µ–ª–∞–µ—Ç –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∑–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é –∏ N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏. –†–µ—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JOIN FETCH, EntityGraph, batch-size –∏ –≥—Ä–∞–º–æ—Ç–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (Hibernate)

**–ß—Ç–æ —Ç–∞–∫–æ–µ LazyInitializationException –∏ –∫–æ–≥–¥–∞ –æ–Ω –≤–æ–∑–Ω–∏–∫–∞–µ—Ç?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

–∫–æ–≥–¥–∞ –ø—ã—Ç–∞–µ–º—Å—è –¥–æ—Å—Ç–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç—å –∏–∑ –±–¥ –≤–Ω–µ —Ä–∞–º–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–ï–≥–æ—Ä, –¥–∞ ‚Äî —Ç—ã –ø–æ–ø–∞–ª –≤ —Å–∞–º—É—é —Å—É—Ç—å, –Ω–æ –¥–∞–≤–∞–π —á—É—Ç—å —Ç–æ—á–Ω–µ–µ, —á—Ç–æ–±—ã –∑–≤—É—á–∞–ª–æ –∫–∞–∫ —É–≤–µ—Ä–µ–Ω–Ω—ã–π Middle/Senior. –°–µ–π—á–∞—Å —Ç–≤–æ–π –æ—Ç–≤–µ—Ç –æ—Ç—Ä–∞–∂–∞–µ—Ç –∏–¥–µ—é, –Ω–æ –µ–≥–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω—ã–º.

# üü© –ß—Ç–æ —É —Ç–µ–±—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- –î–∞, –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç **–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.
    
- –î–∞, –æ–Ω–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø–æ–ø—ã—Ç–∫–æ–π –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î.
    

–≠—Ç–æ –æ—Å–Ω–æ–≤–∞.

# üü¶ –ö–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

## ‚ùó –ß—Ç–æ —Ç–∞–∫–æ–µ LazyInitializationException

> LazyInitializationException –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ —Ç—ã –æ–±—Ä–∞—â–∞–µ—à—å—Å—è –∫ –ª–µ–Ω–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–π —Å–≤—è–∑–∏ (LAZY), –Ω–æ —Å–µ—Å—Å–∏—è Hibernate —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

–¢–æ –µ—Å—Ç—å Hibernate —Ö–æ—á–µ—Ç —Å–¥–µ–ª–∞—Ç—å SELECT, –Ω–æ —É–∂–µ **–Ω–µ –º–æ–∂–µ—Ç**, –ø–æ—Ç–æ–º—É —á—Ç–æ:

- Session –∑–∞–∫—Ä—ã—Ç–∞
    
- —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
    
- —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î –±–æ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ
    

# üü© –ü—Ä–∏–º–µ—Ä

java

```
User user = userService.findById(1); // –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
user.getOrders().size(); // –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Üí LazyInitializationException
```

–ü–æ—á–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ `orders` ‚Äî LAZY, –∏ Hibernate –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Ö **–≤ –º–æ–º–µ–Ω—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è**, –Ω–æ —Å–µ—Å—Å–∏—è —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞.

# üüß –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

- LAZY –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é¬ª.
    
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤–æ–∑–Ω–∏–∫–ª–æ **–ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.
    
- Hibernate –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π Session.
    

# üü¶ –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å LazyInitializationException

## 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **JOIN FETCH**

–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–±.

## 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **EntityGraph**

## 3. –û—Ç–∫—Ä—ã–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–æ–ª—å—à–µ (Open Session in View)

–ù–æ —ç—Ç–æ —Å–ø–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞.

## 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é –∑–∞—Ä–∞–Ω–µ–µ

`Hibernate.initialize(user.getOrders())`

# üüß –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> LazyInitializationException ‚Äî —ç—Ç–æ –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å LAZY‚Äë–¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è Session/—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. Hibernate —Ö–æ—á–µ—Ç —Å–¥–µ–ª–∞—Ç—å SELECT, –Ω–æ —É–∂–µ –Ω–µ –º–æ–∂–µ—Ç.

# ‚ùì –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ Hibernate)

**–ß—Ç–æ —Ç–∞–∫–æ–µ flush –∏ clear –≤ Hibernate Session –∏ —á–µ–º –æ–Ω–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è?**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.

—è –∑–Ω–∞—é –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ –±—ã –¥–∞–Ω–Ω—ã–µ —Å–æ–∑—Ä–∞–Ω–∏–ª–∏—Å—å –≤ –±–¥ clear —Ç–æ–∂–µ —Å–∞–º–æ–µ —Ç–æ–ª—å–∫–æ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º

–ï–≥–æ—Ä, —Ç—ã –Ω–∞—â—É–ø–∞–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –Ω–æ —Å–µ–π—á–∞—Å —É —Ç–µ–±—è —Å–º–µ—à–∞–ª–∏—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –ø–æ–Ω—è—Ç–∏–π. **flush –∏ clear ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**, –∞ –ø—Ä–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å—É—â–Ω–æ—Å—Ç–µ–π –≤–Ω—É—Ç—Ä–∏ Hibernate Session.

–î–∞–≤–∞–π —Ä–∞–∑–ª–æ–∂—É —Ç–∞–∫, —á—Ç–æ–±—ã –∑–≤—É—á–∞–ª–æ –∫–∞–∫ —É–≤–µ—Ä–µ–Ω–Ω—ã–π Middle/Senior.

# üü© –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `flush()`

> **flush() ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫—ç—à–∞ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.**

–¢–æ –µ—Å—Ç—å Hibernate:

- —Å–º–æ—Ç—Ä–∏—Ç, –∫–∞–∫–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã (dirty checking)
    
- –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω—É–∂–Ω—ã–µ SQL (`INSERT`, `UPDATE`, `DELETE`)
    
- –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ –ë–î
    
- **–Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç**
    

–í–∞–∂–Ω–æ:

- `flush()` **–Ω–µ –æ—á–∏—â–∞–µ—Ç Session**
    
- `flush()` **–Ω–µ —É–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã**
    
- `flush()` –ø—Ä–æ—Å—Ç–æ ¬´–≤—ã–≥—Ä—É–∂–∞–µ—Ç¬ª –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î
    

–ü—Ä–∏–º–µ—Ä:

java

```
user.setName("Egor");
session.flush(); // Hibernate –≤—ã–ø–æ–ª–Ω–∏—Ç UPDATE
```

# üüß –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `clear()`

> **clear() ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –∫—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è (Session).**

–¢–æ –µ—Å—Ç—å Hibernate:

- –∑–∞–±—ã–≤–∞–µ—Ç –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
    
- –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è
    
- –¥–µ–ª–∞–µ—Ç Session ¬´–ø—É—Å—Ç–æ–π¬ª
    

–í–∞–∂–Ω–æ:

- `clear()` **–Ω–µ —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î**
    
- `clear()` –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã –∏–∑ –ø–∞–º—è—Ç–∏ Session
    

–ü—Ä–∏–º–µ—Ä:

java

```
session.clear(); // —Ç–µ–ø–µ—Ä—å session –Ω–µ –∑–Ω–∞–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
```

# üü¶ –†–∞–∑–Ω–∏—Ü–∞ –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏

- **flush()** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏ –≤ Session.
    
- **clear()** ‚Äî –æ—á–∏—â–∞–µ—Ç Session, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∏—á–µ–≥–æ –≤ –ë–î.
    

# üüß –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> flush ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ Session —Å –±–∞–∑–æ–π. clear ‚Äî –æ—á–∏—â–∞–µ—Ç Session –∏ –æ—Ç—Å–æ–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏. flush —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è, clear ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç, –Ω–æ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç –ë–î.